/* enchant.js v0.5.1 http://enchantjs.com Licensed under MIT or GPLv3. (c) Ubiquitous Entertainment Inc. */
typeof Object.defineProperty!="function"&&(Object.defineProperty=function(a,b,c){return"value"in c&&(a[b]=c.value),"get"in c&&a.__defineGetter__(b,c.get),"set"in c&&a.__defineSetter__(b,c.set),a}),typeof Object.defineProperties!="function"&&(Object.defineProperties=function(a,b){for(var c in b)b.hasOwnProperty(c)&&Object.defineProperty(a,c,b[c]);return a}),typeof Object.create!="function"&&(Object.create=function(a,b){function c(){}c.prototype=a;var d=new c;return b!=null&&Object.defineProperties(d,b),d}),typeof Object.getPrototypeOf!="function"&&(Object.getPrototypeOf=function(a){return a.__proto__}),typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice.call(arguments,1),d=function(){},e=function(){var e=c.concat(Array.prototype.slice.call(arguments));return b.apply(this instanceof d?this:a||window,e)};return d.prototype=b.prototype,e.prototype=new d,e});var enchant=function(a){a!=null&&(a instanceof Array||(a=Array.prototype.slice.call(arguments)),a=a.filter(function(a){return[a].join()})),function b(c,d){var e=[],f,g;for(var h in c)c.hasOwnProperty(h)&&(typeof c[h]=="function"?window[h]=c[h]:typeof c[h]=="object"&&Object.getPrototypeOf(c[h])===Object.prototype&&(a==null?e.push(h):(f=a.indexOf(d+h),f!==-1&&(e.push(h),a.splice(f,1)))));for(f=0,g=e.length;f<g;f++)b(c[e[f]],d+e[f]+".")}(enchant,"");if(a!=null&&a.length)throw new Error("Cannot load module: "+a.join(", "))};window.addEventListener("message",function(a,b){try{var c=JSON.parse(a.data);if(c.type==="event")enchant.Game.instance.dispatchEvent(new enchant.Event(c.value));else if(c.type==="debug")switch(c.value){case"start":enchant.Game.instance.start();break;case"pause":enchant.Game.instance.pause();break;case"resume":enchant.Game.instance.resume();break;case"tick":enchant.Game.instance._tick();break;default:}}catch(d){}},!1),enchant.Class=function(a,b){return enchant.Class.create(a,b)},enchant.Class.create=function(a,b){if(arguments.length===0)return enchant.Class.create(Object,b);if(arguments.length===1&&typeof arguments[0]!="function")return enchant.Class.create(Object,arguments[0]);for(var c in b)b.hasOwnProperty(c)&&(typeof b[c]=="object"&&Object.getPrototypeOf(b[c])===Object.prototype?"enumerable"in b[c]||(b[c].enumerable=!0):b[c]={value:b[c],enumerable:!0,writable:!0});var d=function(){if(this instanceof d)d.prototype.initialize.apply(this,arguments);else return new d};return d.prototype=Object.create(a.prototype,b),d.prototype.constructor=d,d.prototype.initialize==null&&(d.prototype.initialize=function(){a.apply(this,arguments)}),d},enchant.ENV={VENDOR_PREFIX:function(){var a=navigator.userAgent;return a.indexOf("Opera")!==-1?"O":a.indexOf("MSIE")!==-1?"ms":a.indexOf("WebKit")!==-1?"webkit":navigator.product==="Gecko"?"Moz":""}(),TOUCH_ENABLED:function(){var a=document.createElement("div");return a.setAttribute("ontouchstart","return"),typeof a.ontouchstart=="function"}(),RETINA_DISPLAY:function(){if(navigator.userAgent.indexOf("iPhone")!==-1&&window.devicePixelRatio===2){var a=document.querySelector('meta[name="viewport"]');return a==null&&(a=document.createElement("meta"),document.head.appendChild(a)),a.setAttribute("content","width=640"),!0}return!1}(),USE_FLASH_SOUND:function(){var a=navigator.userAgent,b=navigator.vendor||"";return location.href.indexOf("http")===0&&a.indexOf("Mobile")===-1&&b.indexOf("Apple")!==-1}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"]},enchant.Event=enchant.Class.create({initialize:function(a){this.type=a,this.target=null,this.x=0,this.y=0,this.localX=0,this.localY=0},_initPosition:function(a,b){var c=enchant.Game.instance;this.x=this.localX=(a-c._pageX)/c.scale,this.y=this.localY=(b-c._pageY)/c.scale}}),enchant.Event.LOAD="load",enchant.Event.PROGRESS="progress",enchant.Event.ENTER_FRAME="enterframe",enchant.Event.EXIT_FRAME="exitframe",enchant.Event.ENTER="enter",enchant.Event.EXIT="exit",enchant.Event.ADDED="added",enchant.Event.ADDED_TO_SCENE="addedtoscene",enchant.Event.REMOVED="removed",enchant.Event.REMOVED_FROM_SCENE="removedfromscene",enchant.Event.TOUCH_START="touchstart",enchant.Event.TOUCH_MOVE="touchmove",enchant.Event.TOUCH_END="touchend",enchant.Event.RENDER="render",enchant.Event.INPUT_START="inputstart",enchant.Event.INPUT_CHANGE="inputchange",enchant.Event.INPUT_END="inputend",enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown",enchant.Event.LEFT_BUTTON_UP="leftbuttonup",enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown",enchant.Event.RIGHT_BUTTON_UP="rightbuttonup",enchant.Event.UP_BUTTON_DOWN="upbuttondown",enchant.Event.UP_BUTTON_UP="upbuttonup",enchant.Event.DOWN_BUTTON_DOWN="downbuttondown",enchant.Event.DOWN_BUTTON_UP="downbuttonup",enchant.Event.A_BUTTON_DOWN="abuttondown",enchant.Event.A_BUTTON_UP="abuttonup",enchant.Event.B_BUTTON_DOWN="bbuttondown",enchant.Event.B_BUTTON_UP="bbuttonup",enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var c=this._listeners[a];c==null?this._listeners[a]=[b]:c.indexOf(b)===-1&&c.unshift(b)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(a,b){var c=this._listeners[a];if(c!=null){var d=c.indexOf(b);d!==-1&&c.splice(d,1)}},clearEventListener:function(a){a!=null?delete this._listeners[a]:this._listeners={}},dispatchEvent:function(a){a.target=this,a.localX=a.x-this._offsetX,a.localY=a.y-this._offsetY,this["on"+a.type]!=null&&this["on"+a.type](a);var b=this._listeners[a.type];if(b!=null){b=b.slice();for(var c=0,d=b.length;c<d;c++)b[c].call(this,a)}}}),function(){var a;enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(b,c){if(window.document.body===null)throw new Error("document.body is null. Please excute 'new Game()' in window.onload.");enchant.EventTarget.call(this);var d=!0;a&&(d=!1,a.stop()),a=enchant.Game.instance=this,this.width=b||320,this.height=c||320,this.scale=1;var e=document.getElementById("enchant-stage");if(!e)e=document.createElement("div"),e.id="enchant-stage",e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",e.style.position="absolute",document.body.firstChild?document.body.insertBefore(e,document.body.firstChild):document.body.appendChild(e),this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height),this._pageX=0,this._pageY=0;else{var f=window.getComputedStyle(e);b=parseInt(f.width,10),c=parseInt(f.height,10),b&&c?this.scale=Math.min(b/this.width,c/this.height):(e.style.width=this.width+"px",e.style.height=this.height+"px");while(e.firstChild)e.removeChild(e.firstChild);e.style.position="relative";var g=e.getBoundingClientRect();this._pageX=Math.round(window.scrollX+g.left),this._pageY=Math.round(window.scrollY+g.top)}this.scale||(this.scale=1),e.style.fontSize="12px",e.style.webkitTextSizeAdjust="none",this._element=e,this.fps=30,this.frame=0,this.ready=null,this.running=!1,this.assets={};var h=this._assets=[];(function r(a){a.assets instanceof Array&&[].push.apply(h,a.assets);for(var b in a)a.hasOwnProperty(b)&&typeof a[b]=="object"&&Object.getPrototypeOf(a[b])===Object.prototype&&r(a[b])})(enchant),this._scenes=[],this.currentScene=null,this.rootScene=new enchant.Scene,this.pushScene(this.rootScene),this.loadingScene=new enchant.Scene,this.loadingScene.backgroundColor="#000";var i=this.width*.9|0,j=this.width*.3|0,k=i*.05|0,l=new enchant.Sprite(i,j);l.x=(this.width-i)/2,l.y=(this.height-j)/2;var m=new enchant.Surface(i,j);m.context.fillStyle="#fff",m.context.fillRect(0,0,i,j),m.context.fillStyle="#000",m.context.fillRect(k,k,i-k*2,j-k*2),l.image=m;var n=0,o=0;this.addEventListener("progress",function(a){n=a.loaded/a.total}),l.addEventListener("enterframe",function(){o*=.9,o+=n*.1,m.context.fillStyle="#fff",m.context.fillRect(k,0,(i-k*2)*o,j)}),this.loadingScene.addChild(l),this._mousedownID=0,this._surfaceID=0,this._soundID=0,this._intervalID=null,this._offsetX=0,this._offsetY=0,this.input={},this._keybind={},this.keybind(37,"left"),this.keybind(38,"up"),this.keybind(39,"right"),this.keybind(40,"down");var p=0;["left","right","up","down","a","b"].forEach(function(a){this.addEventListener(a+"buttondown",function(b){var c;this.input[a]||(this.input[a]=!0,c=new enchant.Event(p++?"inputchange":"inputstart"),this.dispatchEvent(c)),this.currentScene.dispatchEvent(b),c&&this.currentScene.dispatchEvent(c)}),this.addEventListener(a+"buttonup",function(b){var c;this.input[a]&&(this.input[a]=!1,c=new enchant.Event(--p?"inputchange":"inputend"),this.dispatchEvent(c)),this.currentScene.dispatchEvent(b),c&&this.currentScene.dispatchEvent(c)})},this);if(d){e=enchant.Game.instance._element;var q;document.addEventListener("keydown",function(b){a.dispatchEvent(new enchant.Event("keydown"));if(37<=b.keyCode&&b.keyCode<=40||b.keyCode===32)b.preventDefault(),b.stopPropagation();if(!a.running)return;var c=a._keybind[b.keyCode];c&&(q=new enchant.Event(c+"buttondown"),a.dispatchEvent(q))},!0),document.addEventListener("keyup",function(b){if(!a.running)return;var c=a._keybind[b.keyCode];c&&(q=new enchant.Event(c+"buttonup"),a.dispatchEvent(q))},!0),enchant.ENV.TOUCH_ENABLED?(e.addEventListener("touchstart",function(b){var c=b.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1&&(b.preventDefault(),a.running||b.stopPropagation())},!0),e.addEventListener("touchmove",function(b){var c=b.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1&&(b.preventDefault(),a.running||b.stopPropagation())},!0),e.addEventListener("touchend",function(b){var c=b.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1&&(b.preventDefault(),a.running||b.stopPropagation())},!0)):(e.addEventListener("mousedown",function(b){var c=b.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1&&(b.preventDefault(),a._mousedownID++,a.running||b.stopPropagation())},!0),e.addEventListener("mousemove",function(b){var c=b.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1&&(b.preventDefault(),a.running||b.stopPropagation())},!0),e.addEventListener("mouseup",function(b){var c=b.target.tagName.toLowerCase();enchant.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(c)===-1&&(b.preventDefault(),a.running||b.stopPropagation())},!0))}},preload:function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments)),[].push.apply(this._assets,a)},load:function(b,c){c==null&&(c=function(){});var d=enchant.Game.findExt(b);if(enchant.Game._loadFuncs[d])enchant.Game._loadFuncs[d].call(this,b,c,d);else{var e=new XMLHttpRequest;e.open("GET",b,!0),e.onreadystatechange=function(d){if(e.readyState===4){if(e.status!==200&&e.status!==0)throw new Error(e.status+": "+"Cannot load an asset: "+b);var f=e.getResponseHeader("Content-Type")||"";f.match(/^image/)?(a.assets[b]=enchant.Surface.load(b),a.assets[b].addEventListener("load",c)):f.match(/^audio/)?(a.assets[b]=enchant.Sound.load(b,f),a.assets[b].addEventListener("load",c)):(a.assets[b]=e.responseText,c())}},e.send(null)}},start:function(){if(this._intervalID)window.clearInterval(this._intervalID);else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!a._touched&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED){var b=new enchant.Scene;b.backgroundColor="#000";var c=Math.round(a.width/10),d=new enchant.Sprite(a.width,c);d.y=(a.height-c)/2,d.image=new enchant.Surface(a.width,c),d.image.context.fillStyle="#fff",d.image.context.font=c-1+"px bold Helvetica,Arial,sans-serif";var e=d.image.context.measureText("Touch to Start").width;d.image.context.fillText("Touch to Start",(a.width-e)/2,c-1),b.addChild(d),document.addEventListener("touchstart",function(){a._touched=!0,a.removeScene(b),a.start()},!0),a.pushScene(b);return}var f={},g=this._assets.filter(function(a){return a in f?!1:f[a]=!0}),h=0,i=g.length,j=function(){var b=new enchant.Event("progress");b.loaded=++h,b.total=i,a.dispatchEvent(b),h===i&&(a.removeScene(a.loadingScene),a.dispatchEvent(new enchant.Event("load")))};for(var k=0;k<i;k++)this.load(g[k],j);this.pushScene(this.loadingScene)}else this.dispatchEvent(new enchant.Event("load"));this.currentTime=Date.now(),this._intervalID=window.setInterval(function(){a._tick()},1e3/this.fps),this.running=!0},debug:function(){this._debug=!0,this.rootScene.addEventListener("enterframe",function(a){this._actualFps=1/a}),this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_tick:function(){var a=Date.now(),b=new enchant.Event("enterframe");b.elapsed=a-this.currentTime,this.currentTime=a;var c=this.currentScene.childNodes.slice(),d=Array.prototype.push;while(c.length){var e=c.pop();e.dispatchEvent(b),e.age++,e.childNodes&&d.apply(c,e.childNodes)}this.currentScene.age++,this.currentScene.dispatchEvent(b),this.dispatchEvent(b),this.dispatchEvent(new enchant.Event("exitframe")),this.frame++},stop:function(){this._intervalID&&(window.clearInterval(this._intervalID),this._intervalID=null),this.running=!1},pause:function(){this._intervalID&&(window.clearInterval(this._intervalID),this._intervalID=null)},resume:function(){if(this._intervalID)return;this.currentTime=Date.now(),this._intervalID=window.setInterval(function(){a._tick()},1e3/this.fps),this.running=!0},pushScene:function(a){return this._element.appendChild(a._element),this.currentScene&&this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=a,this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.push(a)},popScene:function(){return this.currentScene===this.rootScene?this.currentScene:(this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new enchant.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new enchant.Event("enter")),this._scenes.pop())},replaceScene:function(a){return this.popScene(),this.pushScene(a)},removeScene:function(a){if(this.currentScene===a)return this.popScene();var b=this._scenes.indexOf(a);return b!==-1?(this._scenes.splice(b,1),this._element.removeChild(a._element),a):null},keybind:function(a,b){this._keybind[a]=b},getElapsedTime:function(){return this.frame/this.fps}}),enchant.Game._loadFuncs={},enchant.Game._loadFuncs.jpg=enchant.Game._loadFuncs.jpeg=enchant.Game._loadFuncs.gif=enchant.Game._loadFuncs.png=enchant.Game._loadFuncs.bmp=function(a,b){this.assets[a]=enchant.Surface.load(a),this.assets[a].addEventListener("load",b)},enchant.Game._loadFuncs.mp3=enchant.Game._loadFuncs.aac=enchant.Game._loadFuncs.m4a=enchant.Game._loadFuncs.wav=enchant.Game._loadFuncs.ogg=function(a,b,c){this.assets[a]=enchant.Sound.load(a,"audio/"+c),this.assets[a].addEventListener("load",b)},enchant.Game.findExt=function(a){var b=a.match(/\.\w+$/);return b&&b.length>0?b[0].slice(1).toLowerCase():a.indexOf("data:")===0?a.split(/[\/;]/)[1].toLowerCase():null},enchant.Game.instance=null}(),enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this),this._x=0,this._y=0,this._offsetX=0,this._offsetY=0,this.age=0,this.parentNode=null,this.scene=null,this.addEventListener("touchstart",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)}),this.addEventListener("touchmove",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)}),this.addEventListener("touchend",function(a){this.parentNode&&!this.parentNode._element&&this.parentNode.dispatchEvent(a)})},moveTo:function(a,b){this._x=a,this._y=b,this._updateCoordinate()},moveBy:function(a,b){this._x+=a,this._y+=b,this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=a,this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a,this._updateCoordinate()}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y)},remove:function(){this._listener&&this.clearEventListener(),this.parentNode&&this.parentNode.removeChild(this)}}),enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){var a=enchant.Game.instance;enchant.Node.call(this),this._element=document.createElement("div"),this._style=this._element.style,this._style.position="absolute",this._width=0,this._height=0,this._backgroundColor=null,this._opacity=1,this._visible=!0,this._buttonMode=null,enchant.Game.instance._debug&&(this._style.border="1px solid blue",this._style.margin="-1px"),this.buttonMode=null,this.buttonPressed=!1,this.addEventListener("touchstart",function(){if(!this.buttonMode)return;this.buttonPressed=!0;var b=new enchant.Event(this.buttonMode+"buttondown");this.dispatchEvent(b),a.dispatchEvent(b)}),this.addEventListener("touchend",function(){if(!this.buttonMode)return;this.buttonPressed=!1;var b=new enchant.Event(this.buttonMode+"buttonup");this.dispatchEvent(b),a.dispatchEvent(b)});var b=this,c=function(){b.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){c(),a.addEventListener("exitframe",c)}),this.addEventListener("removedfromscene",function(){a.removeEventListener("exitframe",c)}),this.addEventListener("render",function(){this._offsetX!==this._previousOffsetX&&(this._style.left=this._offsetX+"px"),this._offsetY!==this._previousOffsetY&&(this._style.top=this._offsetY+"px"),this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY}),enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(a){var c=a.touches;for(var d=0,e=c.length;d<e;d++)a=new enchant.Event("touchstart"),a.identifier=c[d].identifier,a._initPosition(c[d].pageX,c[d].pageY),b.dispatchEvent(a)},!1),this._element.addEventListener("touchmove",function(a){var c=a.touches;for(var d=0,e=c.length;d<e;d++)a=new enchant.Event("touchmove"),a.identifier=c[d].identifier,a._initPosition(c[d].pageX,c[d].pageY),b.dispatchEvent(a)},!1),this._element.addEventListener("touchend",function(a){var c=a.changedTouches;for(var d=0,e=c.length;d<e;d++)a=new enchant.Event("touchend"),a.identifier=c[d].identifier,a._initPosition(c[d].pageX,c[d].pageY),b.dispatchEvent(a)},!1)):(this._element.addEventListener("mousedown",function(c){var d=c.pageX,e=c.pageY;c=new enchant.Event("touchstart"),c.identifier=a._mousedownID,c._initPosition(d,e),b.dispatchEvent(c),b._mousedown=!0},!1),a._element.addEventListener("mousemove",function(c){if(!b._mousedown)return;var d=c.pageX,e=c.pageY;c=new enchant.Event("touchmove"),c.identifier=a._mousedownID,c._initPosition(d,e),b.dispatchEvent(c)},!1),a._element.addEventListener("mouseup",function(c){if(!b._mousedown)return;var d=c.pageX,e=c.pageY;c=new enchant.Event("touchend"),c.identifier=a._mousedownID,c._initPosition(d,e),b.dispatchEvent(c),b._mousedown=!1},!1))},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},className:{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){(this._visible=a)?this._style.display="block":this._style.display="none"}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){(this._touchEnabled=a)?this._style.pointerEvents="all":this._style.pointerEvents="none"}},intersect:function(a){return this._offsetX<a._offsetX+a.width&&a._offsetX<this._offsetX+this.width&&this._offsetY<a._offsetY+a.height&&a._offsetY<this._offsetY+this.height},within:function(a,b){b==null&&(b=(this.width+this.height+a.width+a.height)/4);var c;return(c=this._offsetX-a._offsetX+(this.width-a.width)/2)*c+(c=this._offsetY-a._offsetY+(this.height-a.height)/2)*c<b*b},scale:function(a,b){b==null&&(b=a),this._scaleX*=a,this._scaleY*=b,this._dirty=!0},rotate:function(a){this._rotation+=a,this._dirty=!0},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a,this._dirty=!0}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a,this._dirty=!0}}}),enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this),this.width=a,this.height=b,this._scaleX=1,this._scaleY=1,this._rotation=0,this._dirty=!1,this._image=null,this._frame=0,this._frameSequence=[],this._style.overflow="hidden",this.addEventListener("render",function(){if(this._dirty){var a=["rotate(",this._rotation,"deg)","scale(",this._scaleX,",",this._scaleY,")"];navigator.userAgent.indexOf("iPhone")!==-1&&a.push("translate3d(0,0,0)"),this._style[enchant.ENV.VENDOR_PREFIX+"Transform"]=a.join(""),this._dirty=!1}}),this.addEventListener("enterframe",function(){if(this._frameSequence.length!==0){var a=this._frameSequence.shift();a===null?this._frameSequence=[]:(this._setFrame(a),this._frameSequence.push(a))}}),enchant.Game.instance._debug&&(this._style.border="1px solid red",this._style.margin="-1px")},image:{get:function(){return this._image},set:function(a){if(a===this._image)return;this._image!=null&&(this._image.css?this._style.backgroundImage="":this._element.firstChild&&(this._element.removeChild(this._element.firstChild),this._dirtyListener?(this.removeEventListener("render",this._dirtyListener),this._dirtyListener=null):this._image._parent=null));if(a!=null)if(a._css)this._style.backgroundImage=a._css;else if(a._parent){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width,b.height=a.height,c.drawImage(a._element,0,0),this._dirtyListener=function(){a._dirty&&(c.drawImage(a._element),a._dirty=!1)},this.addEventListener("render",this._dirtyListener),this._element.appendChild(b)}else a._parent=this,this._element.appendChild(a._element);this._image=a,this.frame=this.frame}},frame:{get:function(){return this._frame},set:function(a){if(a instanceof Array){var b=a,c=b.shift();this._setFrame(c),b.push(c),this._frameSequence=b}else this._setFrame(a),this._frameSequence=[],this._frame=a}},_setFrame:function(a){if(this._image!=null){this._frame=a;var b=this._image.width/this._width|0;if(this._image._css)this._style.backgroundPosition=[-(a%b|0)*this._width,"px ",-(a/b|0)*this._height,"px"].join("");else if(this._element.firstChild){var c=this._element.firstChild.style;c.left=-(a%b|0)*this._width+"px",c.top=-(a/b|0)*this._height+"px"}}}}),enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this),this.width=300,this.text=a,this.textAlign="left"},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},textAlign:{get:function(){return this._style.textAlign},set:function(a){this._style.textAlign=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}}),function(){enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){var c=enchant.Game.instance;enchant.Entity.call(this);var d=document.createElement("canvas");enchant.ENV.RETINA_DISPLAY&&c.scale===2?(d.width=c.width*2,d.height=c.height*2,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(d.width=c.width,d.height=c.height),this._element.appendChild(d),this._context=d.getContext("2d"),this._tileWidth=a||0,this._tileHeight=b||0,this._image=null,this._data=[[[]]],this._dirty=!1,this._tight=!1,this.touchEnabled=!1,this.collisionData=null,this._listeners.render=null,this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null)this._dirty=!1,this.redraw(0,0,c.width,c.height);else if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY)if(this._tight){var a=-this._offsetX,b=-this._offsetY,d=-this._previousOffsetX,e=-this._previousOffsetY,f=a-d+c.width,g=d-a+c.width,h=b-e+c.height,i=e-b+c.height;if(f>this._tileWidth&&g>this._tileWidth&&h>this._tileHeight&&i>this._tileHeight){var j,k,l,m,n,o;f<g?(j=0,l=d-a,n=f):(j=a-d,l=0,n=g),h<i?(k=0,m=e-b,o=h):(k=b-e,m=0,o=i),c._buffer==null&&(c._buffer=document.createElement("canvas"),c._buffer.width=this._context.canvas.width,c._buffer.height=this._context.canvas.height);var p=c._buffer.getContext("2d");this._doubledImage?(p.clearRect(0,0,n*2,o*2),p.drawImage(this._context.canvas,j*2,k*2,n*2,o*2,0,0,n*2,o*2),p=this._context,p.clearRect(l*2,m*2,n*2,o*2),p.drawImage(c._buffer,0,0,n*2,o*2,l*2,m*2,n*2,o*2)):(p.clearRect(0,0,n,o),p.drawImage(this._context.canvas,j,k,n,o,0,0,n,o),p=this._context,p.clearRect(l,m,n,o),p.drawImage(c._buffer,0,0,n,o,l,m,n,o)),l===0?this.redraw(n,0,c.width-n,c.height):this.redraw(0,0,c.width-n,c.height),m===0?this.redraw(0,o,c.width,c.height-o):this.redraw(0,0,c.width,c.height-o)}else this.redraw(0,0,c.width,c.height)}else this.redraw(0,0,c.width,c.height);this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments),this._dirty=!0,this._tight=!1;for(var b=0,c=this._data.length;b<c;b++){var d=0;a=this._data[b];for(var e=0,f=a.length;e<f;e++)for(var g=0,h=a[e].length;g<h;g++)a[e][g]>=0&&d++;if(d/(a.length*a[0].length)>.2){this._tight=!0;break}}},checkTile:function(a,b){if(a<0||this.width<=a||b<0||this.height<=b)return!1;var c=this._image.width,d=this._image.height,e=this._tileWidth||c,f=this._tileHeight||d;a=a/e|0,b=b/f|0;var g=this._data[0];return g[b][a]},hitTest:function(a,b){if(a<0||this.width<=a||b<0||this.height<=b)return!1;var c=this._image.width,d=this._image.height,e=this._tileWidth||c,f=this._tileHeight||d;a=a/e|0,b=b/f|0;if(this.collisionData!=null)return this.collisionData[b]&&!!this.collisionData[b][a];for(var g=0,h=this._data.length;g<h;g++){var i=this._data[g],j;if(i[b]!=null&&(j=i[b][a])!=null&&0<=j&&j<(c/e|0)*(d/f|0))return!0}return!1},image:{get:function(){return this._image},set:function(a){var b=enchant.Game.instance;this._image=a;if(enchant.ENV.RETINA_DISPLAY&&b.scale===2){var c=new enchant.Surface(a.width*2,a.height*2),d=this._tileWidth||a.width,e=this._tileHeight||a.height,f=a.width/d|0,g=a.height/e|0;for(var h=0;h<g;h++)for(var i=0;i<f;i++)c.draw(a,i*d,h*e,d,e,i*d*2,h*e*2,d*2,e*2);this._doubledImage=c}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a,this._dirty=!0}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a,this._dirty=!0}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(a,b,c,d){if(this._image==null)return;var e,f,g,h,i;this._doubledImage?(e=this._doubledImage,f=this._tileWidth*2,g=this._tileHeight*2,h=-this._offsetX*2,i=-this._offsetY*2,a*=2,b*=2,c*=2,d*=2):(e=this._image,f=this._tileWidth,g=this._tileHeight,h=-this._offsetX,i=-this._offsetY);var j=e.width/f|0,k=e.height/g|0,l=Math.max((a+h)/f|0,0),m=Math.max((b+i)/g|0,0),n=Math.ceil((a+h+c)/f),o=Math.ceil((b+i+d)/g),p=e._element,q=this._context,r=q.canvas;q.clearRect(a,b,c,d);for(var s=0,t=this._data.length;s<t;s++){var u=this._data[s],v=Math.min(n,u[0].length),w=Math.min(o,u.length);for(b=m;b<w;b++)for(a=l;a<v;a++){var x=u[b][a];if(0<=x&&x<j*k){var y=x%j*f,z=(x/j|0)*g;q.drawImage(p,y,z,f,g,a*f-h,b*g-i,f,g)}}}}})}(),enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this),this.childNodes=[],this._x=0,this._y=0},addChild:function(a){this.childNodes.push(a),a.parentNode=this,a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");a.scene=this.scene,a.dispatchEvent(b),a._updateCoordinate();var c=document.createDocumentFragment(),d,e=Array.prototype.push;if(a._element)c.appendChild(a._element);else if(a.childNodes){d=a.childNodes.slice().reverse();while(d.length)a=d.pop(),a.scene=this.scene,a.dispatchEvent(b),a._element?c.appendChild(a._element):a.childNodes&&e.apply(d,a.childNodes.reverse())}if(!c.childNodes.length)return;var f,g=this;while(g.parentNode){d=g.parentNode.childNodes,d=d.slice(d.indexOf(g)+1).reverse();while(d.length){a=d.pop();if(a._element){f=a._element;break}a.childNodes&&e.apply(d,a.childNodes.slice().reverse())}g=g.parentNode}f?this.scene._element.insertBefore(c,f):this.scene._element.appendChild(c)}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);if(c!==-1){this.childNodes.splice(c,0,a),a.parentNode=this,a.dispatchEvent(new enchant.Event("added"));if(this.scene){var d=new enchant.Event("addedtoscene");a.scene=this.scene,a.dispatchEvent(d),a._updateCoordinate();var e=document.createDocumentFragment(),f,g=Array.prototype.push;if(a._element)e.appendChild(a._element);else if(a.childNodes){f=a.childNodes.slice().reverse();while(f.length)a=f.pop(),a.scene=this.scene,a.dispatchEvent(d),a._element?e.appendChild(a._element):a.childNodes&&g.apply(f,a.childNodes.reverse())}if(!e.childNodes.length)return;var h,i=b;while(i!==this){c!=null?(f=this.childNodes.slice(c+1).reverse(),c=null):(f=i.parentNode.childNodes,f=f.slice(f.indexOf(i)+1).reverse());while(f.length){a=f.pop();if(a._element){h=a._element;break}a.childNodes&&g.apply(f,a.childNodes.slice().reverse())}i=i.parentNode}h?this.scene._element.insertBefore(e,h):this.scene._element.appendChild(e)}}else this.addChild(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);if(b!==-1)this.childNodes.splice(b,1);else return;a.parentNode=null,a.dispatchEvent(new enchant.Event("removed"));if(this.scene){var c=new enchant.Event("removedfromscene");a.scene=null,a.dispatchEvent(c);if(a._element)this.scene._element.removeChild(a._element);else if(a.childNodes){var d=a.childNodes.slice(),e=Array.prototype.push;while(d.length)a=d.pop(),a.scene=null,a.dispatchEvent(c),a._element?this.scene._element.removeChild(a._element):a.childNodes&&e.apply(d,a.childNodes)}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){this.parentNode?(this._offsetX=this.parentNode._offsetX+this._x,this._offsetY=this.parentNode._offsetY+this._y):(this._offsetX=this._x,this._offsetY=this._y);for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}}),enchant.RGroup=enchant.Class.create(enchant.Group,{initialize:function(a,b){enchant.Group.call(this);if(arguments.length<2)throw"Width and height of RGroup must be specified";this.width=a,this.height=b,this.rotationOrigin={x:a/2,y:b/2},this._rotation=0},addChild:function(a){enchant.Group.prototype.addChild.apply(this,arguments),a.transformOrigin="0 0"},rotation:{get:function(){return this._rotation},set:function(a){var b=a-this._rotation;if(b===0)return;var c=b/180*Math.PI,d=Math.sin(c),e=Math.cos(c),f={x:this.width/2,y:this.height/2};for(var g=0,h=this.childNodes.length;g<h;g++){var i=this.childNodes[g];i.rotation-=b;var j=i.x-f.x,k=i.y-f.y;i.x=+e*j+d*k+f.x,i.y=-d*j+e*k+f.y}this._rotation=a}}}),enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){var a=enchant.Game.instance;enchant.Group.call(this),this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.overflow="hidden",this._element.style.width=(this.width=a.width)+"px",this._element.style.height=(this.height=a.height)+"px",this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+a.scale+")",this.scene=this;var b=this;enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(a){var c=a.touches;for(var d=0,e=c.length;d<e;d++)a=new enchant.Event("touchstart"),a.identifier=c[d].identifier,a._initPosition(c[d].pageX,c[d].pageY),b.dispatchEvent(a)},!1),this._element.addEventListener("touchmove",function(a){var c=a.touches;for(var d=0,e=c.length;d<e;d++)a=new enchant.Event("touchmove"),a.identifier=c[d].identifier,a._initPosition(c[d].pageX,c[d].pageY),b.dispatchEvent(a)},!1),this._element.addEventListener("touchend",function(a){var c=a.changedTouches;for(var d=0,e=c.length;d<e;d++)a=new enchant.Event("touchend"),a.identifier=c[d].identifier,a._initPosition(c[d].pageX,c[d].pageY),b.dispatchEvent(a)},!1)):(this._element.addEventListener("mousedown",function(c){var d=c.pageX,e=c.pageY;c=new enchant.Event("touchstart"),c.identifier=a._mousedownID,c._initPosition(d,e),b.dispatchEvent(c),b._mousedown=!0},!1),a._element.addEventListener("mousemove",function(c){if(!b._mousedown)return;var d=c.pageX,e=c.pageY;c=new enchant.Event("touchmove"),c.identifier=a._mousedownID,c._initPosition(d,e),b.dispatchEvent(c)},!1),a._element.addEventListener("mouseup",function(c){if(!b._mousedown)return;var d=c.pageX,e=c.pageY;c=new enchant.Event("touchend"),c.identifier=a._mousedownID,c._initPosition(d,e),b.dispatchEvent(c),b._mousedown=!1},!1))},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x,this._offsetY=this._y;for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}}),function(){enchant.CanvasGroup=enchant.Class.create(enchant.Group,{initialize:function(){var a=enchant.Game.instance,c=this;enchant.Group.call(this),this._dirty=!1,this._rotation=0,this._cvsCache={},this._cvsCache.matrix=[1,0,0,1,0,0],this._cvsCache.detectColor="#000000",this.width=a.width,this.height=a.height;var d=[enchant.Event.ADDED_TO_SCENE,enchant.Event.REMOVED_FROM_SCENE];d.forEach(function(a){this.addEventListener(a,function(a){this.childNodes.forEach(function(b){b.scene=this.scene,b.dispatchEvent(a)},this)})},this),this._element=document.createElement("canvas"),this._element.width=a.width,this._element.height=a.height,this._element.style.position="absolute",this._detect=document.createElement("canvas"),this._detect.width=a.width,this._detect.height=a.height,this._detect.style.position="absolute",this.context=this._element.getContext("2d"),this._dctx=this._detect.getContext("2d"),this._colorManager=new h(16,256),enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(a){var b=a.touches;for(var d=0,f=b.length;d<f;d++)a=new enchant.Event("touchstart"),a.identifier=b[d].identifier,a._initPosition(b[d].pageX,b[d].pageY),e.call(c,a)},!1),this._element.addEventListener("touchmove",function(a){var b=a.touches;for(var d=0,e=b.length;d<e;d++)a=new enchant.Event("touchmove"),a.identifier=b[d].identifier,a._initPosition(b[d].pageX,b[d].pageY),f.call(c,a)},!1),this._element.addEventListener("touchend",function(a){var b=a.changedTouches;for(var d=0,e=b.length;d<e;d++)a=new enchant.Event("touchend"),a.identifier=b[d].identifier,a._initPosition(b[d].pageX,b[d].pageY),g.call(c,a)},!1)):(this._element.addEventListener("mousedown",function(b){var d=b.pageX,f=b.pageY;b=new enchant.Event("touchstart"),b.identifier=a._mousedownID,b._initPosition(d,f),e.call(c,b),c._mousedown=!0},!1),a._element.addEventListener("mousemove",function(b){if(!c._mousedown)return;var d=b.pageX,e=b.pageY;b=new enchant.Event("touchmove"),b.identifier=a._mousedownID,b._initPosition(d,e),f.call(c,b)},!1),a._element.addEventListener("mouseup",function(b){if(!c._mousedown)return;var d=b.pageX,e=b.pageY;b=new enchant.Event("touchend"),b.identifier=a._mousedownID,b._initPosition(d,e),g.call(c,b),c._mousedown=!1},!1));var i=[enchant.Event.ENTER,enchant.Event.ADDED_TO_SCENE],j=[enchant.Event.EXIT,enchant.Event.REMOVED_FROM_SCENE];i.forEach(function(a){this.addEventListener(a,this._startRendering),this.addEventListener(a,function(){b.push(this)})},this),j.forEach(function(a){this.addEventListener(a,this._stopRendering),this.addEventListener(a,function(){var a=b.indexOf(this);a!==-1&&b.splice(a,1)})},this),this._onexitframe=function(){var b=c.context;b.clearRect(0,0,a.width,a.height),v.call(c,c._colorManager),o.call(c,b)}},_startRendering:function(){var a=enchant.Game.instance;a._listeners.exitframe||(a._listeners.exitframe=[]),a._listeners.exitframe.push(this._onexitframe)},_stopRendering:function(){var a=enchant.Game.instance;a.removeEventListener("exitframe",this._onexitframe)},_getEntityByPosition:function(a,b){var c=this._dctx;c.clearRect(0,0,this.width,this.height),r.call(this,c);var d=c.getImageData(a,b,1,1).data;return this._colorManager.getSpriteByColor(d)},_touchstartPropagation:function(a){var b=this._getEntityByPosition(a.x,a.y);return b?(this._touching=b,z.call(this._touching,a,this.parentNode)):b=null,b},_touchmovePropagation:function(a){this._touching!=null&&z.call(this._touching,a,this.parentNode)},_touchendPropagation:function(a){this._touching!=null&&(z.call(this._touching,a,this.parentNode),this._touching=null)},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a,this._dirty=!0}},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a,this._dirty=!0}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a,this._dirty=!0}},addChild:function(a){this.childNodes.push(a),a.parentNode=this,a.dispatchEvent(new enchant.Event("added"));if(this.scene){a.scene=this.scene;var b=new enchant.Event("addedtoscene");w.call(a,b,this._colorManager)}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);if(c!==-1){this.childNodes.splice(c,0,a),a.dispatchEvent(new enchant.Event("added"));if(this.scene){a.scene=this.scene;var d=new enchant.Event("addedtoscene");w.call(a,d,this._colorManager)}}else this.addChild(a)},removeChild:function(a){var b;(b=this.childNodes.indexOf(a))!==-1&&this.childNodes.splice(b,1),a.parentNode=null,a.dispatchEvent(new enchant.Event("removed"));if(this.scene){a.scene=null;var c=new enchant.Event("removedfromscene");x.call(a,c,this._colorManager)}}});var a=0,b=[],c=null,d=null,e=function(a){var e=enchant.Game.instance,f;for(var g=b.length-1;g>=0;g--){f=b[g];if(f.scene!==e.currentScene)continue;var h=f._touchstartPropagation(a);if(h){c=h,d=f;return}}},f=function(a){d!=null&&d._touchmovePropagation(a)},g=function(a){d!=null&&(d._touchendPropagation(a),c=null,d=null)};enchant.widget&&(enchant.widget.EntityGroup.prototype.cvsRender=function(b){this.background&&this.background._element.width>0&&this.background._element.height>0&&b.drawImage(this.background._element,a,a,this.width+a,this.height+a),b.beginPath(),b.rect(0,0,this.width,this.height),b.clip()}),enchant.Map.prototype.cvsRender=function(a){var b=enchant.Game.instance;a.save(),a.setTransform(1,0,0,1,0,0);var c=this._element.firstChild;a.drawImage(c,0,0,b.width,b.height),a.restore()},enchant.Sprite.prototype.cvsRender=function(b){var c,d,e,f,g,h,i,j;this._image&&(f=Math.abs(this._frame)||0,c=this._image,d=c._element,e=c.width/this._width|0,g=f%e*this._width,h=(f/e|0)*this._height%c.height,h=Math.min(h,c.height-this._height),i=Math.min(c.width-g,this._width),j=Math.min(c.height-h,this._height),b.drawImage(d,g,h,i,j,a,a,this._width+a,this._height+a))},enchant.Label.prototype.cvsRender=function(b){this.text&&(b.textBaseline="top",b.font=this.font,b.fillStyle=this.color||"#000000",b.fillText(this.text,a,a,this.width+a))};var h=enchant.Class.create({initialize:function(a,b){this.reference=[],this.detectColorNum=0,this.colorResolution=a||16,this.max=b||1},attachDetectColor:function(a){return this.detectColorNum+=1,this.reference[this.detectColorNum]=a,this._createNewColor()},detachDetectColor:function(a){var b=this.reference.indexOf(a);b!==-1&&(this.reference[b]=null)},_createNewColor:function(){var a=this.detectColorNum,b=this.colorResolution,c=b/this.max;return[parseInt(a/b/b%b,10)/c,parseInt(a/b%b,10)/c,parseInt(a%b,10)/c,1]},_decodeDetectColor:function(a){var b=this.colorResolution;return~~(a[0]*b*b*b/256)+~~(a[1]*b*b/256)+~~(a[2]*b/256)},getSpriteByColor:function(a){return this.reference[this._decodeDetectColor(a)]}}),i=function(a,b){a=a||function(){},b=b||function(){};var c=function(){a.apply(this,arguments);var d;if(this.childNodes)for(var e=0,f=this.childNodes.length;e<f;e++)d=this.childNodes[e],c.apply(d,arguments);b.apply(this,arguments)};return c},j=function(a,b){var c=a.x,d=a.y,e=a.width||0,f=a.height||0,g=a.rotation||0,h=typeof a.scaleX=="number"?a.scaleX:1,i=typeof a.scaleY=="number"?a.scaleY:1,j=Math.PI*g/180,k=Math.cos(j),l=Math.sin(j),m=typeof a.originX=="number"?a.originX:e/2,n=typeof a.originY=="number"?a.originY:f/2,o=h*k,p=h*l,q=i*l,r=i*k;b[0]=h*k,b[1]=h*l,b[2]=-i*l,b[3]=i*k,b[4]=-o*m+q*n+c+m,b[5]=-p*m-r*n+d+n},k=function(a){if(a.__dirty||a._cvsCache.x!==a.x||a._cvsCache.y!==a.y||a._cvsCache.width!==a.width||a._cvsCache.height!==a.height)j(a,a._cvsCache.matrix),a.__dirty=!1,a._cvsCache.x=a.x,a._cvsCache.y=a.y,a._cvsCache.width=a.width,a._cvsCache.height=a.height},l=function(a,b){b.alphaBlending?a.globalCompositeOperation=b.alphaBlending:a.globalCompositeOperation="source-atob",a.globalAlpha=b.opacity||1},m=function(a,b){k(b),a.transform.apply(a,b._cvsCache.matrix)},n=function(b,c){var d=enchant.Game.instance;c.backgroundColor&&(b.fillStyle=c.backgroundColor,b.fillRect(a,a,c.width+a,c.height+a)),c.cvsRender&&c.cvsRender(b),d._debug&&(c instanceof enchant.Label||c instanceof enchant.Sprite?b.strokeStyle="#ff0000":b.strokeStyle="#0000ff",b.strokeRect(a,a,c.width+a,c.height+a))},o=i(function(a){a.save(),l(a,this),m(a,this),n(a,this)},function(a){a.restore()}),p=function(a){return"#"+("00"+Number(parseInt(a[0],10)).toString(16)).slice(-2)+("00"+Number(parseInt(a[1],10)).toString(16)).slice(-2)+("00"+Number(parseInt(a[2],10)).toString(16)).slice(-2)},q=function(a,b){a.fillStyle=b._cvsCache.detectColor,a.fillRect(0,0,b.width,b.height)},r=i(function(a){a.save(),m(a,this),q(a,this)},function(a){a.restore()}),s=function(){this._dirty?this.__dirty=!0:this.__dirty=!1},t=function(a){if(this._cvsCache)return;this.addEventListener("render",s),this._cvsCache={},this._cvsCache.matrix=[],this._cvsCache.detectColor=p(a.attachDetectColor(this))},u=function(a){if(!this._cvsCache)return;this.removeEventListener("render",s),a.detachDetectColor(this),delete this._cvsCache},v=i(function(a){t.call(this,a)}),w=i(function(a,b){this.dispatchEvent(a),t.call(this,b)}),x=i(function(a,b){this.dispatchEvent(a),u.call(this,b)}),y=i(function(a){this.dispatchEvent(a)}),z=function(a,b){this.dispatchEvent(a),this.parentNode&&this.parentNode!==b&&z.call(this.parentNode,a,b)}}(),enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this),this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.overflow="hidden",this._element.style.width=(this.width=enchant.Game.instance.width)+"px",this._element.style.height=(this.height=enchant.Game.instance.height)+"px",this._element.style[enchant.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._element.style[enchant.ENV.VENDOR_PREFIX+"Transform"]="scale("+enchant.Game.instance.scale+")",this.scene=this;var a=this;enchant.ENV.TOUCH_ENABLED?(this._element.addEventListener("touchstart",function(b){var c=b.touches;for(var d=0,e=c.length;d<e;d++)b=new enchant.Event("touchstart"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchmove",function(b){var c=b.touches;for(var d=0,e=c.length;d<e;d++)b=new enchant.Event("touchmove"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1),this._element.addEventListener("touchend",function(b){var c=b.changedTouches;for(var d=0,e=c.length;d<e;d++)b=new enchant.Event("touchend"),b.identifier=c[d].identifier,b._initPosition(c[d].pageX,c[d].pageY),a.dispatchEvent(b)},!1)):(this._element.addEventListener("mousedown",function(b){var c=b.pageX,d=b.pageY;b=new enchant.Event("touchstart"),b.identifier=enchant.Game.instance._mousedownID,b._initPosition(c,d),a.dispatchEvent(b),a._mousedown=!0},!1),enchant.Game.instance._element.addEventListener("mousemove",function(b){if(!a._mousedown)return;var c=b.pageX,d=b.pageY;b=new enchant.Event("touchmove"),b.identifier=enchant.Game.instance._mousedownID,b._initPosition(c,d),a.dispatchEvent(b)},!1),enchant.Game.instance._element.addEventListener("mouseup",function(b){if(!a._mousedown)return;var c=b.pageX,d=b.pageY;b=new enchant.Event("touchend"),b.identifier=enchant.Game.instance._mousedownID,b._initPosition(c,d),a.dispatchEvent(b),a._mousedown=!1},!1))},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x,this._offsetY=this._y;for(var a=0,b=this.childNodes.length;a<b;a++)this.childNodes[a]._updateCoordinate()}}),enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);var c=enchant.Game.instance;this.width=a,this.height=b,this.context=null;var d="enchant-surface"+c._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",d,a,b),this._element=this.context.canvas,this._css="-webkit-canvas("+d+")";var e=this.context}else document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._css="-moz-element(#"+d+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(d,this._element)):(this._element=document.createElement("canvas"),this._element.width=a,this._element.height=b,this._element.style.position="absolute",this.context=this._element.getContext("2d"),enchant.ENV.CANVAS_DRAWING_METHODS.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments),this._dirty=!0}},this))},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,c,d,e,f){var g=this.context.createImageData(1,1);g.data[0]=c,g.data[1]=d,g.data[2]=e,g.data[3]=f,this.context.putImageData(g,a,b)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){a=a._element;if(arguments.length===1)this.context.drawImage(a,0,0);else{var b=arguments;b[0]=a,this.context.drawImage.apply(this.context,b)}},clone:function(){var a=new enchant.Surface(this.width,this.height);return a.draw(this),a},toDataURL:function(){var a=this._element.src;return a?a.slice(0,5)==="data:"?a:this.clone().toDataURL():this._element.toDataURL()}}),enchant.Surface.load=function(a){var b=new Image,c=Object.create(enchant.Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});return enchant.EventTarget.call(c),b.src=a,b.onerror=function(){throw new Error("Cannot load an asset: "+b.src)},b.onload=function(){c.width=b.width,c.height=b.height,c.dispatchEvent(new enchant.Event("load"))},c},enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){throw enchant.EventTarget.call(this),this.duration=0,new Error("Illegal Constructor")},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause(),this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio)a=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}});else{if(enchant.ENV.USE_FLASH_SOUND)return this;a=Object.create(enchant.Sound.prototype)}return enchant.EventTarget.call(a),a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){this._element&&(this._element.currentTime=a)}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){this._element&&(this._element.volume=a)}}}),enchant.Sound.load=function(a,b){if(b==null){var c=enchant.Game.findExt(a);c?b="audio/"+c:b=""}b=b.replace("mp3","mpeg").replace("m4a","mp4");var d=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(d);var e=new Audio;if(!enchant.Sound.enabledInMobileSafari&&enchant.ENV.VENDOR_PREFIX==="webkit"&&enchant.ENV.TOUCH_ENABLED)window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);else if(!enchant.ENV.USE_FLASH_SOUND&&e.canPlayType(b))e.src=a,e.load(),e.autoplay=!1,e.onerror=function(){throw new Error("Cannot load an asset: "+e.src)},e.addEventListener("canplaythrough",function(){d.duration=e.duration,d.dispatchEvent(new enchant.Event("load"))},!1),d._element=e;else if(b==="audio/mpeg"){var f=document.createElement("embed"),g="enchant-audio"+enchant.Game.instance._soundID++;f.width=f.height=1,f.name=g,f.src="sound.swf?id="+g+"&src="+a,f.allowscriptaccess="always",f.style.position="absolute",f.style.left="-1px",d.addEventListener("load",function(){Object.defineProperties(f,{currentTime:{get:function(){return f.getCurrentTime()},set:function(a){f.setCurrentTime(a)}},volume:{get:function(){return f.getVolume()},set:function(a){f.setVolume(a)}}}),d._element=f,d.duration=f.getDuration()}),enchant.Game.instance._element.appendChild(f),enchant.Sound[g]=d}else window.setTimeout(function(){d.dispatchEvent(new enchant.Event("load"))},0);return d},enchant.Sound.enabledInMobileSafari=!1;