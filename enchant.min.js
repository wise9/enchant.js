/**
 * enchant.js v0.4.1
 *
 * Copyright (c) Ubiquitous Entertainment Inc.
 * Dual licensed under the MIT or GPL Version 3 licenses
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
if(typeof Object.defineProperty!="function"){Object.defineProperty=function(a,b,c){if("value"in c)a[b]=c.value;if("get"in c)a.__defineGetter__(b,c.get);if("set"in c)a.__defineSetter__(b,c.set);return a}}if(typeof Object.defineProperties!="function"){Object.defineProperties=function(a,b){for(var c in b)if(b.hasOwnProperty(c)){Object.defineProperty(a,c,b[c])}return a}}if(typeof Object.create!="function"){Object.create=function(a,b){function c(){}c.prototype=a;var d=new c;if(b!=null)Object.defineProperties(d,b);return d}}if(typeof Object.getPrototypeOf!="function"){Object.getPrototypeOf=function(a){return a.__proto__}}var enchant=function(a){if(a!=null){if(!(a instanceof Array)){a=Array.prototype.slice.call(arguments)}a=a.filter(function(a){return[a].join()})}(function b(c,d){var e=[];for(var f in c)if(c.hasOwnProperty(f)){if(typeof c[f]=="function"){window[f]=c[f]}else if(Object.getPrototypeOf(c[f])==Object.prototype){if(a==null){e.push(f)}else{g=a.indexOf(d+f);if(g!=-1){e.push(f);a.splice(g,1)}}}}for(var g=0,h=e.length;g<h;g++){b(c[e[g]],d+e[g]+".")}})(enchant,"");if(a!=null&&a.length){throw new Error("Cannot load module: "+a.join(", "))}};(function(){"use strict";var a=function(){var a=navigator.userAgent;if(a.indexOf("Opera")!=-1){return"O"}else if(a.indexOf("MSIE")!=-1){return"ms"}else if(a.indexOf("WebKit")!=-1){return"webkit"}else if(navigator.product=="Gecko"){return"Moz"}else{return""}}();var b=function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return typeof a.ontouchstart=="function"}();var c=function(){if(navigator.userAgent.indexOf("iPhone")!=-1&&window.devicePixelRatio==2){var a=document.querySelector('meta[name="viewport"]');if(a==null){a=document.createElement("meta");document.head.appendChild(a)}a.setAttribute("content","width=640px");return true}else{return false}}();var d;enchant.Class=function(a,b){return enchant.Class.create(a,b)};enchant.Class.create=function(a,b){if(arguments.length==0){return enchant.Class.create(Object,b)}else if(arguments.length==1&&typeof arguments[0]!="function"){return enchant.Class.create(Object,arguments[0])}for(var c in b)if(b.hasOwnProperty(c)){if(Object.getPrototypeOf(b[c])==Object.prototype){if(!("enumerable"in b[c]))b[c].enumerable=true}else{b[c]={value:b[c],enumerable:true,writable:true}}}var d=function(){if(this instanceof d){d.prototype.initialize.apply(this,arguments)}else{return new d}};d.prototype=Object.create(a.prototype,b);d.prototype.constructor=d;if(d.prototype.initialize==null){d.prototype.initialize=function(){a.apply(this,arguments)}}return d};enchant.Event=enchant.Class.create({initialize:function(a){this.type=a;this.target=null;this.x=0;this.y=0;this.localX=0;this.localY=0},_initPosition:function(a,b){this.x=this.localX=(a-d._pageX)/d.scale;this.y=this.localY=(b-d._pageY)/d.scale}});enchant.Event.LOAD="load";enchant.Event.PROGRESS="progress";enchant.Event.ENTER_FRAME="enterframe";enchant.Event.EXIT_FRAME="exitframe";enchant.Event.ENTER="enter";enchant.Event.EXIT="exit";enchant.Event.ADDED="added";enchant.Event.ADDED_TO_SCENE="addedtoscene";enchant.Event.REMOVED="removed";enchant.Event.REMOVED_FROM_SCENE="removedfromscene";enchant.Event.TOUCH_START="touchstart";enchant.Event.TOUCH_MOVE="touchmove";enchant.Event.TOUCH_END="touchend";enchant.Event.RENDER="render";enchant.Event.INPUT_START="inputstart";enchant.Event.INPUT_CHANGE="inputchange";enchant.Event.INPUT_END="inputend";enchant.Event.LEFT_BUTTON_DOWN="leftbuttondown";enchant.Event.LEFT_BUTTON_UP="leftbuttonup";enchant.Event.RIGHT_BUTTON_DOWN="rightbuttondown";enchant.Event.RIGHT_BUTTON_UP="rightbuttonup";enchant.Event.UP_BUTTON_DOWN="upbuttondown";enchant.Event.UP_BUTTON_UP="upbuttonup";enchant.Event.DOWN_BUTTON_DOWN="downbuttondown";enchant.Event.DOWN_BUTTON_UP="downbuttonup";enchant.Event.A_BUTTON_DOWN="abuttondown";enchant.Event.A_BUTTON_UP="abuttonup";enchant.Event.B_BUTTON_DOWN="bbuttondown";enchant.Event.B_BUTTON_UP="bbuttonup";enchant.EventTarget=enchant.Class.create({initialize:function(){this._listeners={}},addEventListener:function(a,b){var c=this._listeners[a];if(c==null){this._listeners[a]=[b]}else if(c.indexOf(b)==-1){c.unshift(b)}},removeEventListener:function(a,b){var c=this._listeners[a];if(c!=null){var d=c.indexOf(b);if(d!=-1){c.splice(d,1)}}},dispatchEvent:function(a){a.target=this;a.localX=a.x-this._offsetX;a.localY=a.y-this._offsetY;if(this["on"+a.type]!=null)this["on"+a.type]();var b=this._listeners[a.type];if(b!=null){b=b.slice();for(var c=0,d=b.length;c<d;c++){b[c].call(this,a)}}}});enchant.Game=enchant.Class.create(enchant.EventTarget,{initialize:function(a,c){enchant.EventTarget.call(this);var e=true;if(d){e=false;d.stop()}d=enchant.Game.instance=this;this.width=a||320;this.height=c||320;this.scale=1;var f=document.getElementById("enchant-stage");if(!f){f=document.createElement("div");f.id="enchant-stage";f.style.width=window.innerWidth+"px";f.style.height=window.innerHeight+"px";f.style.position="absolute";if(document.body.firstChild){document.body.insertBefore(f,document.body.firstChild)}else{document.body.appendChild(f)}this.scale=Math.min(window.innerWidth/this.width,window.innerHeight/this.height);this._pageX=0;this._pageY=0}else{var g=window.getComputedStyle(f);a=parseInt(g.width);c=parseInt(g.height);if(a&&c){this.scale=Math.min(a/this.width,c/this.height)}else{f.style.width=this.width+"px";f.style.height=this.height+"px"}while(f.firstChild){f.removeChild(f.firstChild)}f.style.position="relative";var h=f.getBoundingClientRect();this._pageX=Math.round(window.scrollX+h.left);this._pageY=Math.round(window.scrollY+h.top)}if(!this.scale)this.scale=1;f.style.fontSize="12px";f.style.webkitTextSizeAdjust="none";this._element=f;this.fps=30;this.frame=0;this.ready=null;this.running=false;this.assets={};var i=this._assets=[];(function r(a){if(a.assets instanceof Array){[].push.apply(i,a.assets)}for(var b in a)if(a.hasOwnProperty(b)){if(Object.getPrototypeOf(a[b])==Object.prototype){r(a[b])}}})(enchant);this._scenes=[];this.currentScene=null;this.rootScene=new enchant.Scene;this.pushScene(this.rootScene);this.loadingScene=new enchant.Scene;this.loadingScene.backgroundColor="#000";var j=this.width*.9|0;var k=this.width*.3|0;var l=j*.05|0;var m=new enchant.Sprite(j,k);m.x=(this.width-j)/2;m.y=(this.height-k)/2;var n=new enchant.Surface(j,k);n.context.fillStyle="#fff";n.context.fillRect(0,0,j,k);n.context.fillStyle="#000";n.context.fillRect(l,l,j-l*2,k-l*2);m.image=n;var o=0,p=0;this.addEventListener("progress",function(a){o=a.loaded/a.total});m.addEventListener("enterframe",function(){p*=.9;p+=o*.1;n.context.fillStyle="#fff";n.context.fillRect(l,0,(j-l*2)*p,k)});this.loadingScene.addChild(m);this._mousedownID=0;this._surfaceID=0;this._soundID=0;this._intervalID=null;this.input={};this._keybind={};this.keybind(37,"left");this.keybind(38,"up");this.keybind(39,"right");this.keybind(40,"down");var q=0;["left","right","up","down","a","b"].forEach(function(a){this.addEventListener(a+"buttondown",function(b){if(!this.input[a]){this.input[a]=true;this.dispatchEvent(new enchant.Event(q++?"inputchange":"inputstart"))}this.currentScene.dispatchEvent(b)});this.addEventListener(a+"buttonup",function(b){if(this.input[a]){this.input[a]=false;this.dispatchEvent(new enchant.Event(--q?"inputchange":"inputend"))}this.currentScene.dispatchEvent(b)})},this);if(e){document.addEventListener("keydown",function(a){d.dispatchEvent(new enchant.Event("keydown"));if(37<=a.keyCode&&a.keyCode<=40||a.keyCode==32){a.preventDefault();a.stopPropagation()}if(!d.running)return;var b=d._keybind[a.keyCode];if(b){var a=new enchant.Event(b+"buttondown");d.dispatchEvent(a)}},true);document.addEventListener("keyup",function(a){if(!d.running)return;var b=d._keybind[a.keyCode];if(b){var a=new enchant.Event(b+"buttonup");d.dispatchEvent(a)}},true);if(b){document.addEventListener("touchstart",function(a){a.preventDefault()},true);document.addEventListener("touchmove",function(a){a.preventDefault();if(!d.running)a.stopPropagation()},true);document.addEventListener("touchend",function(a){a.preventDefault();if(!d.running)a.stopPropagation()},true)}else{document.addEventListener("mousedown",function(a){a.preventDefault();d._mousedownID++;if(!d.running)a.stopPropagation()},true);document.addEventListener("mousemove",function(a){a.preventDefault();if(!d.running)a.stopPropagation()},true);document.addEventListener("mouseup",function(a){a.preventDefault();if(!d.running)a.stopPropagation()},true)}}},preload:function(a){if(!(a instanceof Array)){a=Array.prototype.slice.call(arguments)}[].push.apply(this._assets,a)},load:function(a,b){if(b==null)b=function(){};var c=a.match(/_._w+$/)[0];if(c)c=c.slice(1).toLowerCase();switch(c){case"jpg":case"gif":case"png":d.assets[a]=enchant.Surface.load(a);d.assets[a].addEventListener("load",b);break;case"mp3":case"aac":case"m4a":case"wav":case"ogg":d.assets[a]=enchant.Sound.load(a,"audio/"+c);d.assets[a].addEventListener("load",b);break;default:var e=new XMLHttpRequest;e.open("GET",a,true);e.onreadystatechange=function(c){if(e.readyState==4){if(e.status!=200){throw new Error("Cannot load an asset: "+a)}var f=e.getResponseHeader("Content-Type")||"";if(f.match(/^image/)){d.assets[a]=enchant.Surface.load(a);d.assets[a].addEventListener("load",b)}else if(f.match(/^audio/)){d.assets[a]=enchant.Sound.load(a,f);d.assets[a].addEventListener("load",b)}else{d.assets[asset]=e.responseText;b()}}};e.send(null)}},start:function(){if(this._intervalID){window.clearInterval(this._intervalID)}else if(this._assets.length){if(enchant.Sound.enabledInMobileSafari&&!d._touched&&a=="webkit"&&b){var c=new Scene;c.backgroundColor="#000";var e=Math.round(d.width/10);var f=new Sprite(d.width,e);f.y=(d.height-e)/2;f.image=new Surface(d.width,e);f.image.context.fillStyle="#fff";f.image.context.font=e-1+"px bold Helvetica,Arial,sans-serif";var g=f.image.context.measureText("Touch to Start").width;f.image.context.fillText("Touch to Start",(d.width-g)/2,e-1);c.addChild(f);document.addEventListener("touchstart",function(){d._touched=true;d.removeScene(c);d.start()},true);d.pushScene(c);return}var h={};var i=this._assets.filter(function(a){return a in h?false:h[a]=true});var j=0;for(var k=0,l=i.length;k<l;k++){this.load(i[k],function(){var a=new enchant.Event("progress");a.loaded=++j;a.total=l;d.dispatchEvent(a);if(j==l){d.removeScene(d.loadingScene);d.dispatchEvent(new enchant.Event("load"))}})}this.pushScene(this.loadingScene)}else{this.dispatchEvent(new enchant.Event("load"))}this.currentTime=Date.now();this._intervalID=window.setInterval(function(){d._tick()},1e3/this.fps);this.running=true},_tick:function(){var a=Date.now();var b=new enchant.Event("enterframe");b.elapsed=a-this.currentTime;this.currentTime=a;var c=this.currentScene.childNodes.slice();var d=Array.prototype.push;while(c.length){var e=c.pop();e.dispatchEvent(b);if(e.childNodes){d.apply(c,e.childNodes)}}this.currentScene.dispatchEvent(b);this.dispatchEvent(b);this.dispatchEvent(new enchant.Event("exitframe"));this.frame++},stop:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}this.running=false},pause:function(){if(this._intervalID){window.clearInterval(this._intervalID);this._intervalID=null}},pushScene:function(a){this._element.appendChild(a._element);if(this.currentScene){this.currentScene.dispatchEvent(new enchant.Event("exit"))}this.currentScene=a;this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.push(a)},popScene:function(){if(this.currentScene==this.rootScene){return}this._element.removeChild(this.currentScene._element);this.currentScene.dispatchEvent(new enchant.Event("exit"));this.currentScene=this._scenes[this._scenes.length-2];this.currentScene.dispatchEvent(new enchant.Event("enter"));return this._scenes.pop()},replaceScene:function(a){this.popScene();return this.pushScene(a)},removeScene:function(a){if(this.currentScene==a){return this.popScene()}else{var b=this._scenes.indexOf(a);if(b!=-1){this._scenes.splice(b,1);this._element.removeChild(a._element);return a}}},keybind:function(a,b){this._keybind[a]=b}});enchant.Game.instance=null;enchant.Node=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);this._x=0;this._y=0;this._offsetX=0;this._offsetY=0;this.parentNode=null;this.scene=null;this.addEventListener("touchstart",function(a){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(a)}});this.addEventListener("touchmove",function(a){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(a)}});this.addEventListener("touchend",function(a){if(this.parentNode&&this.parentNode!=this.scene){this.parentNode.dispatchEvent(a)}})},moveTo:function(a,b){this._x=a;this._y=b;this._updateCoordinate()},moveBy:function(a,b){this._x+=a;this._y+=b;this._updateCoordinate()},x:{get:function(){return this._x},set:function(a){this._x=a;this._updateCoordinate()}},y:{get:function(){return this._y},set:function(a){this._y=a;this._updateCoordinate()}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}}});enchant.Entity=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._element=document.createElement("div");this._style=this._element.style;this._style.position="absolute";this._width=0;this._height=0;this._backgroundColor=null;this._opacity=1;this._visible=true;this._buttonMode=null;this.buttonMode=null;this.buttonPressed=false;this.addEventListener("touchstart",function(){if(!this.buttonMode)return;this.buttonPressed=true;var a=new Event(button+"buttondown");this.dispatchEvent(a);d.dispatchEvent(a)});this.addEventListener("touchend",function(){if(!this.buttonMode)return;this.buttonPressed=false;var a=new Event(button+"buttonup");this.dispatchEvent(a);d.dispatchEvent(a)});var a=this;var c=function(){a.dispatchEvent(new enchant.Event("render"))};this.addEventListener("addedtoscene",function(){c();d.addEventListener("exitframe",c)});this.addEventListener("removedfromscene",function(){d.removeEventListener("exitframe",c)});this.addEventListener("render",function(){if(this._offsetX!=this._previousOffsetX){this._style.left=this._offsetX+"px"}if(this._offsetY!=this._previousOffsetY){this._style.top=this._offsetY+"px"}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY});var a=this;if(b){this._element.addEventListener("touchstart",function(b){var c=b.touches;for(var d=0,e=c.length;d<e;d++){b=new enchant.Event("touchstart");b.identifier=c[d].identifier;b._initPosition(c[d].pageX,c[d].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchmove",function(b){var c=b.touches;for(var d=0,e=c.length;d<e;d++){b=new enchant.Event("touchmove");b.identifier=c[d].identifier;b._initPosition(c[d].pageX,c[d].pageY);a.dispatchEvent(b)}},false);this._element.addEventListener("touchend",function(b){var c=b.changedTouches;for(var d=0,e=c.length;d<e;d++){b=new enchant.Event("touchend");b.identifier=c[d].identifier;b._initPosition(c[d].pageX,c[d].pageY);a.dispatchEvent(b)}},false)}else{this._element.addEventListener("mousedown",function(b){var c=b.pageX;var e=b.pageY;b=new enchant.Event("touchstart");b.identifier=d._mousedownID;b._initPosition(c,e);a.dispatchEvent(b);a._mousedown=true},false);d._element.addEventListener("mousemove",function(b){if(!a._mousedown)return;var c=b.pageX;var e=b.pageY;b=new enchant.Event("touchmove");b.identifier=d._mousedownID;b._initPosition(c,e);a.dispatchEvent(b)},false);d._element.addEventListener("mouseup",function(b){if(!a._mousedown)return;var c=b.pageX;var e=b.pageY;b=new enchant.Event("touchend");b.identifier=d._mousedownID;b._initPosition(c,e);a.dispatchEvent(b);a._mousedown=false},false)}},id:{get:function(){return this._element.id},set:function(a){this._element.id=a}},"class":{get:function(){return this._element.className},set:function(a){this._element.className=a}},width:{get:function(){return this._width},set:function(a){this._style.width=(this._width=a)+"px"}},height:{get:function(){return this._height},set:function(a){this._style.height=(this._height=a)+"px"}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},opacity:{get:function(){return this._opacity},set:function(a){this._style.opacity=this._opacity=a}},visible:{get:function(){return this._visible},set:function(a){if(this._visible=a){this._style.display="block"}else{this._style.display="none"}}},touchEnabled:{get:function(){return this._touchEnabled},set:function(a){if(this._touchEnabled=a){this._style.pointerEvents="all"}else{this._style.pointerEvents="none"}}},intersect:function(a){return this.x<a.x+a.width&&a.x<this.x+this.width&&this.y<a.y+a.height&&a.y<this.y+this.height},within:function(a,b){if(b==null){b=(this.width+this.height+a.width+a.height)/4}var c;return(c=this.x-a.x+(this.width-a.width)/2)*c+(c=this.y-a.y+(this.height-a.height)/2)*c<b*b}});enchant.Sprite=enchant.Class.create(enchant.Entity,{initialize:function(b,c){enchant.Entity.call(this);this.width=b;this.height=c;this._scaleX=1;this._scaleY=1;this._rotation=0;this._dirty=false;this._image=null;this._frame=0;this._style.overflow="hidden";this.addEventListener("render",function(){if(this._dirty){this._style[a+"Transform"]=["rotate(",this._rotation,"deg)","scale(",this._scaleX,",",this._scaleY,")"].join("");this._dirty=false}})},image:{get:function(){return this._image},set:function(a){if(a==this._image)return;if(this._image!=null){if(this._image.css){this._style.backgroundImage=""}else if(this._element.firstChild){this._element.removeChild(this._element.firstChild);if(this._dirtyListener){this.removeEventListener("render",this._dirtyListener);this._dirtyListener=null}else{this._image._parent=null}}}if(a!=null){if(a._css){this._style.backgroundImage=a._css}else if(a._parent){var b=document.createElement("canvas");var c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a._element,0,0);this._dirtyListener=function(){if(a._dirty){c.drawImage(a._element);a._dirty=false}};this.addEventListener("render",this._dirtyListener);this._element.appendChild(b)}else{a._parent=this;this._element.appendChild(a._element)}}this._image=a}},frame:{get:function(){return this._frame},set:function(a){this._frame=a;var b=this._image.width/this._width|0;if(this._image._css){this._style.backgroundPosition=[-(a%b)*this._width,"px ",-(a/b|0)*this._height,"px"].join("")}else if(this._element.firstChild){var c=this._element.firstChild.style;c.left=-(a%b)*this._width+"px";c.top=-(a/b|0)*this._height+"px"}}},scale:function(a,b){if(b==null)b=a;this._scaleX*=a;this._scaleY*=b;this._dirty=true},rotate:function(a){this._rotation+=a;this._dirty=true},scaleX:{get:function(){return this._scaleX},set:function(a){this._scaleX=a;this._dirty=true}},scaleY:{get:function(){return this._scaleY},set:function(a){this._scaleY=a;this._dirty=true}},rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._dirty=true}}});enchant.Label=enchant.Class.create(enchant.Entity,{initialize:function(a){enchant.Entity.call(this);this.width=300;this.text=a},text:{get:function(){return this._element.innerHTML},set:function(a){this._element.innerHTML=a}},font:{get:function(){return this._style.font},set:function(a){this._style.font=a}},color:{get:function(){return this._style.color},set:function(a){this._style.color=a}}});enchant.Map=enchant.Class.create(enchant.Entity,{initialize:function(a,b){enchant.Entity.call(this);var e=document.createElement("canvas");if(c&&d.scale==2){e.width=d.width*2;e.height=d.height*2;this._style.webkitTransformOrigin="0 0";this._style.webkitTransform="scale(0.5)"}else{e.width=d.width;e.height=d.height}this._element.appendChild(e);this._context=e.getContext("2d");this._tileWidth=a||0;this._tileHeight=b||0;this._image=null;this._data=[[[]]];this._dirty=false;this._tight=false;this.touchEnabled=false;this.collisionData=null;this._listeners["render"]=null;this.addEventListener("render",function(){if(this._dirty||this._previousOffsetX==null){this._dirty=false;this.redraw(0,0,d.width,d.height)}else if(this._offsetX!=this._previousOffsetX||this._offsetY!=this._previousOffsetY){if(this._tight){var a=-this._offsetX;var b=-this._offsetY;var c=-this._previousOffsetX;var e=-this._previousOffsetY;var f=a-c+d.width;var g=c-a+d.width;var h=b-e+d.height;var i=e-b+d.height;if(f>this._tileWidth&&g>this._tileWidth&&h>this._tileHeight&&i>this._tileHeight){var j,k,l,m,n,o;if(f<g){j=0;l=c-a;n=f}else{j=a-c;l=0;n=g}if(h<i){k=0;m=e-b;o=h}else{k=b-e;m=0;o=i}if(d._buffer==null){d._buffer=document.createElement("canvas");d._buffer.width=this._context.canvas.width;d._buffer.height=this._context.canvas.height}var p=d._buffer.getContext("2d");if(this._doubledImage){p.clearRect(0,0,n*2,o*2);p.drawImage(this._context.canvas,j*2,k*2,n*2,o*2,0,0,n*2,o*2);p=this._context;p.clearRect(l*2,m*2,n*2,o*2);p.drawImage(d._buffer,0,0,n*2,o*2,l*2,m*2,n*2,o*2)}else{p.clearRect(0,0,n,o);p.drawImage(this._context.canvas,j,k,n,o,0,0,n,o);p=this._context;p.clearRect(l,m,n,o);p.drawImage(d._buffer,0,0,n,o,l,m,n,o)}if(l==0){this.redraw(n,0,d.width-n,d.height)}else{this.redraw(0,0,d.width-n,d.height)}if(m==0){this.redraw(0,o,d.width,d.height-o)}else{this.redraw(0,0,d.width,d.height-o)}}else{this.redraw(0,0,d.width,d.height)}}else{this.redraw(0,0,d.width,d.height)}}this._previousOffsetX=this._offsetX;this._previousOffsetY=this._offsetY})},loadData:function(a){this._data=Array.prototype.slice.apply(arguments);this._dirty=true;this._tight=false;for(var b=0,c=this._data.length;b<c;b++){var d=0;var a=this._data[b];for(var e=0,f=a.length;e<f;e++){for(var g=0,h=a[e].length;g<h;g++){if(a[e][g]>=0)d++}}if(d/(a.length*a[0].length)>.2){this._tight=true;break}}},hitTest:function(a,b){if(a<0||this.width<=a||b<0||this.height<=b){return false}var c=this._image.width;var d=this._image.height;var e=this._tileWidth||c;var f=this._tileHeight||d;a=a/e|0;b=b/f|0;if(this.collisionData!=null){return this.collisionData[b]&&!!this.collisionData[b][a]}else{for(var g=0,h=this._data.length;g<h;g++){var i=this._data[g];var j;if(i[b]!=null&&(j=i[b][a])!=null&&0<=j&&j<(c/e|0)*(d/f|0)){return true}}return false}},image:{get:function(){return this._image},set:function(a){this._image=a;if(c&&d.scale==2){var b=new Surface(a.width*2,a.height*2);var e=this._tileWidth||a.width;var f=this._tileHeight||a.height;var g=a.width/e|0;var h=a.height/f|0;for(var i=0;i<h;i++){for(var j=0;j<g;j++){b.draw(a,j*e,i*f,e,f,j*e*2,i*f*2,e*2,f*2)}}this._doubledImage=b}this._dirty=true}},tileWidth:{get:function(){return this._tileWidth},set:function(a){this._tileWidth=a;this._dirty=true}},tileHeight:{get:function(){return this._tileHeight},set:function(a){this._tileHeight=a;this._dirty=true}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(a,b,c,d){if(this._image==null){return}var e,f,g,h,i;if(this._doubledImage){e=this._doubledImage;f=this._tileWidth*2;g=this._tileHeight*2;h=-this._offsetX*2;i=-this._offsetY*2;a*=2;b*=2;c*=2;d*=2}else{e=this._image;f=this._tileWidth;g=this._tileHeight;h=-this._offsetX;i=-this._offsetY}var j=e.width/f|0;var k=e.height/g|0;var l=Math.max((a+h)/f|0,0);var m=Math.max((b+i)/g|0,0);var n=Math.ceil((a+h+c)/f);var o=Math.ceil((b+i+d)/g);var p=e._element;var q=this._context;var r=q.canvas;q.clearRect(a,b,c,d);for(var s=0,t=this._data.length;s<t;s++){var u=this._data[s];var v=Math.min(n,u[0].length);var w=Math.min(o,u.length);for(b=m;b<w;b++){for(a=l;a<v;a++){var x=u[b][a];if(0<=x&&x<j*k){var y=x%j*f;var z=(x/j|0)*g;q.drawImage(p,y,z,f,g,a*f-h,b*g-i,f,g)}}}}}});enchant.Group=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this.childNodes=[];this._x=0;this._y=0},addChild:function(a){this.childNodes.push(a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var b=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(b);a._updateCoordinate();var c=document.createDocumentFragment();var d;var e=Array.prototype.push;if(a._element){c.appendChild(a._element)}else if(a.childNodes){d=a.childNodes.slice().reverse();while(d.length){a=d.pop();a.scene=this.scene;a.dispatchEvent(b);if(a._element){c.appendChild(a._element)}else if(a.childNodes){e.apply(d,a.childNodes.reverse())}}}if(!c.childNodes.length)return;var f,g=this;while(g.parentNode){d=g.parentNode.childNodes;d=d.slice(d.indexOf(g)+1).reverse();while(d.length){a=d.pop();if(a._element){f=a._element;break}else if(a.childNodes){e.apply(d,a.childNodes.slice().reverse())}}g=g.parentNode}if(f){this.scene._element.insertBefore(c,f)}else{this.scene._element.appendChild(c)}}},insertBefore:function(a,b){var c=this.childNodes.indexOf(b);if(c!=-1){this.childNodes.splice(c,0,a);a.parentNode=this;a.dispatchEvent(new enchant.Event("added"));if(this.scene){var d=new enchant.Event("addedtoscene");a.scene=this.scene;a.dispatchEvent(d);a._updateCoordinate();var e=document.createDocumentFragment();var f;var g=Array.prototype.push;if(a._element){e.appendChild(a._element)}else if(a.childNodes){f=a.childNodes.slice().reverse();while(f.length){a=f.pop();a.scene=this.scene;a.dispatchEvent(d);if(a._element){e.appendChild(a._element)}else if(a.childNodes){g.apply(f,a.childNodes.reverse())}}}if(!e.childNodes.length)return;var h,i=b;while(i.parentNode){if(c!=null){f=this.childNodes.slice(c+1).reverse();c=null}else{f=i.parentNode.childNodes;f=f.slice(f.indexOf(i)+1).reverse()}while(f.length){a=f.pop();if(a._element){h=a._element;break}else if(a.childNodes){g.apply(f,a.childNodes.slice().reverse())}}i=i.parentNode}if(h){this.scene._element.insertBefore(e,h)}else{this.scene._element.appendChild(e)}}}else{this.addChild(a)}},removeChild:function(a){var b=this.childNodes.indexOf(a);if(b!=-1){this.childNodes.splice(b,1)}else{return}a.parentNode=null;a.dispatchEvent(new enchant.Event("removed"));if(this.scene){var c=new enchant.Event("removedfromscene");a.scene=null;a.dispatchEvent(c);if(a._element){this.scene._element.removeChild(a._element)}else if(a.childNodes){var d=a.childNodes.slice();var e=Array.prototype.push;while(d.length){a=d.pop();a.scene=null;a.dispatchEvent(c);if(a._element){this.scene._element.removeChild(a._element)}else if(a.childNodes){e.apply(d,a.childNodes)}}}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},_updateCoordinate:function(){if(this.parentNode){this._offsetX=this.parentNode._offsetX+this._x;this._offsetY=this.parentNode._offsetY+this._y}else{this._offsetX=this._x;this._offsetY=this._y}for(var a=0,b=this.childNodes.length;a<b;a++){this.childNodes[a]._updateCoordinate()}}});enchant.Scene=enchant.Class.create(enchant.Group,{initialize:function(){enchant.Group.call(this);this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.overflow="hidden";this._element.style.width=(this.width=d.width)+"px";this._element.style.height=(this.height=d.height)+"px";this._element.style[a+"TransformOrigin"]="0 0";this._element.style[a+"Transform"]="scale("+d.scale+")";this.scene=this;var c=this;if(b){this._element.addEventListener("touchstart",function(a){var b=a.touches;for(var d=0,e=b.length;d<e;d++){a=new enchant.Event("touchstart");a.identifier=b[d].identifier;a._initPosition(b[d].pageX,b[d].pageY);c.dispatchEvent(a)}},false);this._element.addEventListener("touchmove",function(a){var b=a.touches;for(var d=0,e=b.length;d<e;d++){a=new enchant.Event("touchmove");a.identifier=b[d].identifier;a._initPosition(b[d].pageX,b[d].pageY);c.dispatchEvent(a)}},false);this._element.addEventListener("touchend",function(a){var b=a.changedTouches;for(var d=0,e=b.length;d<e;d++){a=new enchant.Event("touchend");a.identifier=b[d].identifier;a._initPosition(b[d].pageX,b[d].pageY);c.dispatchEvent(a)}},false)}else{this._element.addEventListener("mousedown",function(a){var b=a.pageX;var e=a.pageY;a=new enchant.Event("touchstart");a.identifier=d._mousedownID;a._initPosition(b,e);c.dispatchEvent(a);c._mousedown=true},false);d._element.addEventListener("mousemove",function(a){if(!c._mousedown)return;var b=a.pageX;var e=a.pageY;a=new enchant.Event("touchmove");a.identifier=d._mousedownID;a._initPosition(b,e);c.dispatchEvent(a)},false);d._element.addEventListener("mouseup",function(a){if(!c._mousedown)return;var b=a.pageX;var e=a.pageY;a=new enchant.Event("touchend");a.identifier=d._mousedownID;a._initPosition(b,e);c.dispatchEvent(a);c._mousedown=false},false)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._element.style.backgroundColor=this._backgroundColor=a}},_updateCoordinate:function(){this._offsetX=this._x;this._offsetY=this._y;for(var a=0,b=this.childNodes.length;a<b;a++){this.childNodes[a]._updateCoordinate()}}});var e=["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"];enchant.Surface=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b){enchant.EventTarget.call(this);this.width=a;this.height=b;this.context=null;var c="enchant-surface"+d._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",c,a,b);this._element=this.context.canvas;this._css="-webkit-canvas("+c+")";var f=this.context}else if(document.mozSetImageElement){this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._css="-moz-element(#"+c+")";this.context=this._element.getContext("2d");document.mozSetImageElement(c,this._element)}else{this._element=document.createElement("canvas");this._element.width=a;this._element.height=b;this._element.style.position="absolute";this.context=this._element.getContext("2d");e.forEach(function(a){var b=this.context[a];this.context[a]=function(){b.apply(this,arguments);this._dirty=true}},this)}},getPixel:function(a,b){return this.context.getImageData(a,b,1,1).data},setPixel:function(a,b,c,d,e,f){var g=this.context.createImageData(1,1);g.data[0]=c;g.data[1]=d;g.data[2]=e;g.data[3]=f;this.context.putImageData(g,a,b,1,1)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(a){arguments[0]=a=a._element;if(arguments.length==1){this.context.drawImage(a,0,0)}else{this.context.drawImage.apply(this.context,arguments)}},clone:function(){var a=new enchant.Surface(this.width,this.height);a.draw(this);return a}});enchant.Surface.load=function(a){var b=new Image;var c=Object.create(Surface.prototype,{context:{value:null},_css:{value:"url("+a+")"},_element:{value:b}});enchant.EventTarget.call(c);b.src=a;b.onerror=function(){throw new Error("Cannot load an asset: "+b.src)};b.onload=function(){c.width=b.width;c.height=b.height;c.dispatchEvent(new enchant.Event("load"))};return c};enchant.Sound=enchant.Class.create(enchant.EventTarget,{initialize:function(){enchant.EventTarget.call(this);throw new Error("Illegal Constructor");this.duration=0},play:function(){if(this._element)this._element.play()},pause:function(){if(this._element)this._element.pause()},stop:function(){this.pause();this.currentTime=0},clone:function(){var a;if(this._element instanceof Audio){a=Object.create(enchant.Sound.prototype,{_element:{value:this._element.cloneNode(false)},duration:{value:this.duration}})}else{a=Object.create(enchant.Sound.prototype)}enchant.EventTarget.call(a);return a},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(a){if(this._element)this._element.currentTime=a}},volume:{get:function(){return this._element?this._element.volume:1},set:function(a){if(this._element)this._element.volume=a}}});enchant.Sound.load=function(c,e){if(e==null){var f=c.match(/_._w+$/)[0];if(f){e="audio/"+f.slice(1).toLowerCase()}else{e=""}}e=e.replace("mp3","mpeg");var g=Object.create(enchant.Sound.prototype);enchant.EventTarget.call(g);var h=new Audio;if(!enchant.Sound.enabledInMobileSafari&&a=="webkit"&&b){window.setTimeout(function(){g.dispatchEvent(new enchant.Event("load"))},0)}else{if(h.canPlayType(e)){h.src=c;h.load();h.autoplay=false;h.onerror=function(){throw new Error("Cannot load an asset: "+h.src)};h.addEventListener("canplaythrough",function(){g.duration=h.duration;g.dispatchEvent(new enchant.Event("load"))},false);g._element=h}else if(e=="audio/mpeg"){var i=document.createElement("embed");var j="enchant-audio"+d._soundID++;i.width=i.height=1;i.name=j;i.src="sound.swf?id="+j+"&src="+c;i.allowscriptaccess="always";i.style.position="absolute";i.style.left="-1px";g.addEventListener("load",function(){Object.defineProperties(i,{currentTime:{get:function(){return i.getCurrentTime()},set:function(a){i.setCurrentTime(a)}},volume:{get:function(){return i.getVolume()},set:function(a){i.setVolume(a)}}});g._element=i;g.duration=i.getDuration()});d._element.appendChild(i);enchant.Sound[j]=g}else{window.setTimeout(function(){g.dispatchEvent(new enchant.Event("load"))},0)}}return g};enchant.Sound.enabledInMobileSafari=false})()